❤️ GFW
Great Firewall of China  中国国家防火墙.   简称GFW
政府监控和过滤互联网国际出口内容 一套软硬件系统.
数百台超级服务器组成的集群.

现在GFW已经有能力对 基于PPTP/L2TP 等协议的VPN 进行监控和封锁.
每到关键时刻(敏感时期) 防火长城均会加大网络审查和封锁的力度，
部分破网软件就可能因此无法正常连接或连接异常缓慢，
甚至中国境内和境外的正常网络连接也会受到干扰：


主要技术:

📌 污染域名解析服务器
比如访问 www.google.com
其实需要域名解析服务器 把www.google.com 转换成一个 23.105.192.96 IP地址
国家控制了 这个域名解析服务器. 把 www.google.com 转换成一个 111.111.111.111  这种不存在的IP地址你当然就访问不了了.


📌 封锁境外IP地址
你买国外VPS 主要就是拿来翻墙的. 这个vps 只有一个固定的IP地址.
哪天政府检测到你这个IP. 就会把这个IP直接从 宽带供应商这里过滤掉.
你在国内 就上不去这个IP. 也就翻不了墙了. 你的VPS也就白买了...

📌 封锁特定IP端口
封锁整个IP地址 太过分了. 那就封锁某几个常用的翻墙端口.
SSH 22、HTTP 80、PPTP 1723、L2TP 1701、IPSec 500/4500、OpenVPN 1194
一般人能用默认配置在vps上搭建个出ss就不错了.
你要修改端口, 那就得深入研究. 没几年IT经验是学不会的,这样也能杜绝大部分想翻又不会翻的了.

📌 无状态TCP协议连接重置
TCP 重置是一种消息.
TCP 是安全连接.双方电脑需要很多参数都对的上 才能建立连接.
TCP 重置也就是断开连接. 也就是第三方黑客要冒充别人和你通信. 
你发现暗号对不上知道有问题.就发送一个重置信息端口对方的连接.

对GFW这套系统来说 用连接重置 比直接丢弃数据包好.
直接丢弃数据包. 发送放可能以为网络不好,会不断的重新发送数据包. 加重GFW系统负担.
用连接重置就说明是对方主动要和你断开连接的. 你也就不会再发数据过去了.效果很好.成本相当低.

📌 关键字过滤.
从出口网关分析数据. 直接过滤指定关键字. 
比如发现 http 请求数据包头部 host参数值: www.youtube.com 直接过滤数据包..






📌 电子邮件的拦截.

邮件服务器之间传输邮件或者数据不会进行加密，故防火长城能轻易过滤进出境内外的大部分邮件，
当发现关键字后会通过伪造RST封包阻断连接。使得邮件发不出去.


📌 网络攻击
DDOS 用大量的网络流量对某个网站进行攻击.
15年 Github 遭受史上最大的DDoS攻击. 好像就是 GFW干的...
































❤️️️ ️ 科学上网主要分两类: 翻墙 和 穿墙.
    翻墙: 代理、VPN、   需要一个国外代理服务器.
    穿墙: 研究GFW特点. 用特殊方式使得GFW屏蔽失效.

    翻墙: 速度慢.比如美国的服务器. 和中国隔了半个地球.
    穿墙: 速度好.但是能力有限,很多网站靠穿墙是没用的.
    很多工具都是 结合翻墙+穿墙结合的.



📌 GFW 原理



穿墙:
    1. HOSTS
        想要获得某个网址的IP
        电脑首先查本地的Hosts文件. 如果这里有找到 那就优先使用这个.
        把谷歌真正的ip写到这个文件里面 就可以访问谷歌了. 就这么简单.
        但是.谷歌是用很多IP地址的. 有时候会有些ip地址失效.
        需要经常更新这个hosts列表,麻烦!!!!

    2. 流量混淆
        一种加密.使得GFW很难分出 数据到底是用的那种协议. 比如 https 和 openvpn.
        GFW封锁 openvpn是坚决的. 但是要封锁https 那就.....

    3. 加密协议.
        GFW经常进行关键字审查. 加密后GFW就审查不出了. 


翻墙:
1. HTTP/socks 代理
GFW早就了解这个了. 随时会被封掉.


2. VPN
终极方案了. 几乎可以访问任何网站.



















❤️ 翻墙原则:
    能代理就先代理，代理不行再挂VPN，VPN要少用，万一被检测出来，后果很严重。。
    比如国家公共场所,肯定不会让你用google的. 一般ss代理都无效的情况才用vpn.



❤️ 免费开源 VPN:  http://www.vpngate.net/cn/
    一个在线服务网站, 免费的!!! 网站上有一个公共VPN服务器列表. 
    互联网上的任何认都可以 建立vpn连接到这个列表上的 vpn服务器. 无需注册.




GFW对 VPN的封杀力度也是最大的. 
一切GFW认不出来的流量都认为是网络罪犯. 会对这些流量进行监控.
轻则封杀 vpn/ss 这些 重则封杀整个IP. 你都登不进服务器...
所以现在用VPN. 不能用原生的. 必须使用变种的 openvpn.




作用:   
1. 访问被墙网站.
2. 通过追踪一个服务器访问日志的ip地址 可以确定一个人的隐私信息.
一个ip地址  不仅仅是个人信息. 还可以用来跟踪在各个网站产生活动的个人.
这种技术 常用来 垃圾邮件. 或者强制广告.


IP 还可以确定谁是发起通信的人..
警察可以要求互联网供应商 提供IP地址分配的日志文件.
一旦有人获得日志.
 就可以调查 谁发了什么邮件. 或者某个网站发了什么 暴力信息...

 最好有一个办法 来隐藏你的iP地址.
 就像肉机. 你既然能控制肉机器. 就能控制肉机里面的日志文件. 可以删除日志.
 然后用肉鸡去攻击某个服务器. 肉鸡连服务器 服务器肯定也会有日志的.
 这个日志没法删除.  当然通过这个日志也只能追踪到那台肉机. 


 公共wifi 数据包被窃听风险.


 互联网上 使用 http pop3 imap 纯文本 你是无法避免被窃听的.
 ssl/https 是安全的.

 最好的方法是  对所有到互联网服务器的通信都加密.
 这种情况 没人可以看出你真正的内容.

 vpn 可以解决这些问题.

 1. 可以绕过防火墙 GFW也是一个防火墙.
2. 可以隐藏你的真实 IP.
3. 可以防止在本地网络上的窃听.

vpn 和 vpn gate 区别:

vpn 你需要有一台海外的物理服务器 并搭建vpn服务器. 才能用vpn.
大多用户都无法拥有海外的vpn服务器, 一些互联网公司提供了现有的、付费的、共享的 VPN 服务。
因此，不同于现有的共享 VPN 服务， 

vpn 上的ip 很少变.

















  
   VPN: 虚拟专用网络.
📌 VPN种类:  PPTP、L2TP、IPSec、SSL VPN(OpenVPN)

    PPTP 点对点隧道协议.  主要给经常外出移动办公的人考虑.
    L2TP PPTP的后续版本.
    SSL VPN: (openvpn)    主要总公司和分公司直接用.  
        📌📌 OpenVPN 属于C/S架构,需要单独安装客户端,系统默认的VPN设置是不支持openVPN的 !!!!
        优点: 穿透能力最强!!! 适合学校/图书馆/公司等受限网络环境.





❤️ openvpn 简介:
参考: https://linux.cn/article-3706-2.html

  服务器生成证书.
  客户端要先获得服务器的证书 才能成功连接.
  类似网银.大多数银行都会要求你下载并安装一个数字证书.

  就算你用账户密码登录. 还是需要证书的.
  CA证书 和 服务器证书还是需要的!!!

  身份验证脚本:      checkpwd.sh，保存在/etc/openvpn目录中
  用户名密码文件：   pwd-file，   保存在/etc/openvpn目录中
  OpenVPN主配置文件：server.conf，保存在/etc/openvpn目录中


  通常情况下，ca证书和客户端证书要以独立文件的形式发放给每个OpenVPN用户，
  而且其存放路径还要与客户端主配置文件中声明的路径保持一致。


  sudo systemctl restart openvpn@server
    "@"后面的“server”，对应/etc/openvpn/server.conf，表示：用/etc/openvpn/server.conf配置文件启动OpenVPN服务。


📌 openvpn 安装:
  帮瓦工控制面板能快速安装 openvpn
  虽然会快速帮你安装. 但是自己还是要熟悉一下安装流程的.
  安装教程: http://www.taaae.com/827.html
  查看版本:    openvpn -version



CentOS. 
📌 一: 服务器环境安装      (控制面板已经帮我们安装好了)
    yum install openvpn easy-rsa dnsmasq
      🔵 openvpn
          提供了OpenVPN的核心
      
      🔵 easy-rsa
          包含了一些有用的密钥管理脚本
          可以用来方便的制作 ca证书. 服务器证书,客户端证书

      🔵dnsmasq
          是当我们的OpenVPN所在的主机将扮演客户端的路由器时会用到的域名服务器


📌 二: 生成证书和私钥  最关键的一步.(控制面板已经帮我们安装好了)

    为OpenVPN服务器创建一个证书(公钥)和一个私钥
    为每个OpenVPN客户端创建证书和私钥
    建立一个证书颁发机构(CA)并创建证书和私钥。这个私钥用来给OpenVPN服务器和客户端的证书签名
    
    /etc/openvpn/easy-rsa/keys  下面可以看到很多文件.

        ca.crt – 证书颁发机构(CA)的证书
        ca.key – CA的私钥
        delta.crt – OpenVPN服务器的证书  / 也许是 server.crt 只是名字不一样而已
        delta.key – OpenVPN服务器的私钥  / 也许是 server.key
        dh2048.pem – Diffie-Hellman参数文件

        现在我们需要拷贝除了ca.key的文件到/etc/openvpn:   (控制面板已经帮我们安装好了)


📌 三: 为OpenVPN客户端生成证书和私钥
在/etc/openvpn/easy-rsa有一个脚本帮我们完成这项工作:
1: cd /etc/openvpn/easy-rsa
2: ./build-key rmbp  
3: 输入 国家名 CN
4: 输入省份  shanghai
城市 shanghai
公司??  xx 
???    oo
主机名字:  RMBP13
name: macvpn
邮箱: xx2610@gmail.com
密码   xujianxujian
公司: xxx
y → y → 就好了.
现在 keys 文件夹下面 就多了 
rmbp.crt  证书 
rmbp.key  私钥
这两个文件 加上 CA证书.   把这三个文件放到某个文件夹中.
把这三个文件 安全的拷贝到 笔记本上.

23.105.192.96


创建根证书. ./easyrsa build-ca
这里需要输入 pem 密码.  必须记住. 不然以后不能给证书签名..


创建服务端证书.
./easyrsa gen-req server nopass
该过程中需要输入common name，随意但是不要跟之前的根证书的一样


签约服务端证书:
./easyrsa sign server server
该命令中.需要你确认生成，要输入yes，还需要你提供我们当时创建CA时候的密码。
如果你忘记了密码，那你就重头开始再来一次吧。


创建Diffie-Hellman，确保key穿越不安全网络的命令：


创建客户端证书













运行 openvpn 服务器: 
service openvpn start



默认监听 1194 端口
用 netstat -anup 查看.




📌 搭建DNS服务器...  这也是为什么需要 dnsmasq

vi /etc/dnsmasq.conf
listen 行改成→ listen-address=127.0.0.1, 23.105.192.96
#bind-interfaces 这行去掉#

重启dnsmasq
service dnsmasq restart





添加路由功能:
其实就是 数据先到 vpn服务器. vpn服务器再把你的数据转给你要访问的网站.这就是路由.
我们希望在一些机器或虚拟机上运行的OpneVPN有路由的功能，这意味着要开启IP转发。

echo "1" > /proc/sys/net/ipv4/ip_forward
这就设置好了.

为了让这个设置 在重启之后 还是生效的. 
vi /etc/sysctl.conf
#net.ipv4.ip_forward=1  这行前面的#删除就可以了.
没有这行 就把 net.ipv4.ip_forward = 0 的0改成1.

激活一些 iptables 服务器规则.



当然了，我们希望每次Ubuntu启动的时候，这些规则都好用。所以我们得把它们加到/etc/rc.local里:

/etc/rc.local    里加一行:   service dnsmasq restart   就可以了...

这非常重要:在系统启动时，dnsmasq会尝试在OpenVPN之前启动。但是OpenVPN启动之前是没有隧道(tun0)接口的，所以dnsmasq自然就挂了。过了一阵，当/etc/rc.local读到隧道(tun0)接口出现时，它会在这时重启dnsmasq然后就一切如你所愿了。






客户端设置:

先官网下载安装openvpn的客户端. 

然后用 sftp 命令把上面生成的三个文件下载下来
ca.crt xxx.crt xxx.key //这三个文件

找到安装目录






























📌客户端设置
1. 下载对应的openvon客户端!!!
2. 配置密钥证书.  把服务器生成的keys 拷贝到本地.
3. 创建 client.ovpn



✘✘∙𝒗 ~ scp -P 27401 -r root@23.105.192.96:/etc/openvpn/easy-rsa/keys/ ./
上传 本地文件夹路径在前面的.
下载的话 本文件夹路径在最后的.



mac openvpn 配置.
客户端可以用官网的. 

也可以用第三方的 
Tunnelblicks    免费
shimo 最先进的vpn       需破解  中文名石墨.
viscosity 最好用的....  需破解




配置文件... 
.tblk .ovpn  .conf 结尾的.  必须要..
应该是你的 服务器提供的...
没有就创建一个模板 然后修改...




首先 我们来用 Tunnelblicks 
只有这个会创建模板...  我们修改下模块 就能用了 ..

模板文件中:
remote my-server-1 1194
行改成
remote 23.105.192.96 1194

cert client.crt  客户端证书名字  cert rmbp.crt
key client.key   客户端密钥名字  cert rmbp.key



